# netty in action

![네티 인 액션](https://wikibook.co.kr/images/cover/l/9791158390327.jpg)

## 1장. 비동기식 이벤트 기반 네트워킹 프레임워크
- 네티는 유지관리가 용이한 고성능 프로토콜 서버와 클라이언트를 신속하게 개발하기 위한 비동기식 이벤트 기반 네트워크 애플리케이션 프레임워크.
    + 오래 사용해본 결과 네티는 기본적으로 비동기식 프레임워크라서, 동기작업에 대한 부분은 까다로울 수 있다.
    
- LOW-LEVEL API (java socket)을 직접 이용하면 복잡성이 높아진다.
   
- 네티를 통해 성능, 설계, 이용 편이성을 극대화 할 수 있다.

- 핵심 컴포넌트
    + Channel : IO 데이터를 위한 운송수단
        + 각 채널에는 이벤트 루프가 할당 되어 있으며, 이벤트 루프는 이벤트를 등록, 핸들러로 발송, 스케쥴링과 같은 작업을 수행할 수 있다.
    + 콜백 : 다른 메소드로 자신에 대한 참조를 제공할 수 있는 메소드
    + Future : 작업이 완료되면 이를 애플리케이션에 알리는 방법
    + 이벤트와 핸들러 : 작업의 상태 변화를 알리기 위한 이벤트를 이용하며, 핸들러를 통해 적절히 트리거 할 수 있음
        + 동작 : 로깅, 데이터변환, 흐름 제어, 애플리케이션 논리
        + 인바운드 데이터로 인한 이벤트 : 연결 활성화/비활성화, 데이터 읽기, 사용자이벤트, 오류이벤트
        + 아웃바운드 이벤트로 인한 동작 : 원격 피어로 연결 열기 또는 닫기, 소켓으로 데이터 쓰기 또는 플러시
    
    
- 네티는 결국 저수준의 자바 API(Selector, Future.. 등)를 감싼 프레임워크로써 고수준의 API를 제공한다.

## 2장. 네티 애플리케이션
- 모든 네티 서버는 하나 이상의 ChannelHandler와 bootstrap이 필요함
    + channelHandler: 클라이언트로부터 전송받은 데이터를 서버측에서 처리하는 비지니스 로직을 구성
    + bootstrap : 서버를 구성하는 시동 코드를 의미한다. 한마디로 서버를 구동하기 위한 옵션을 설정하는 헬퍼 클래스  
- 채널핸들러에서 read, readComplete, exceptionCaught 등 처리를 할 수 있는데 예외의 경우 핸들러 체인 어디에서도 처리되지 않을 경우지 수신된 예외가 파이프라인의 끝까지 이동한후에 로깅한다.

- simpleChannelInboundHandler와 ChannelInboundHandler 비교
    + channelRead 시점에 netty의 설정에 따라 handler는 heap memory 혹은 native memory 영역에 할당된 byteBuf를 참조한다.
    + simpleChannelInboundHandler는 channelRead()를 완료하고 반환하는 시점에 핸들러가 참조한 byteBuf에 대한 메모리 참조를 해제한다. 

- [에코 서버/클라이언트 예제 구현해보기](https://swiftymind.tistory.com/56?category=694951)     
   

## 3장. 네티 컴포넌트 설계

- 네티는 자바 NIO 기반의 비동기식 이벤트 기반 구현을 이용해 고부하 조건에서도 애플리케이션의 성능과 확장성을 최대한 보장한다.
- 네티는 애플리케이션 논리를 네트워크 레이어로부터 분리하는 다양한 설계 패턴을 활용해 테스트 용이성, 모듈성, 재사용성을 극대화해 개발을 간소화한다.

- channel 인터페이스: 자바 기반 네트워크에서 기본 구조는 socket 클래스. 채널 인터페이스는 소켓 작업의 복잡성을 완화한다.
- EventLoop 인터페이스: 이벤트루프는 연결의 수명주기 중 발생하는 이벤트를 처리하는 네티의 핵심 추상화를 정의한다. 생명주기는 다음과 같다.
    + 하나의 이벤트 루프 그룹은 하나 이상의 이벤트루프를 포함한다.
    + 한 이벤트 루프는 라이프사이클 동안 하나의 스레드로 바인딩된다.
    + 한 이벤트 루프에서 처리되는 모든 입출력 이벤트는 해당 전용 쓰레드에서 처리된다.
    + 한 채널은 수명주ㅜ기 동안 한 이벤트루프에 등록할 수 있다.
    + 한 이벤트 루프는 한 채널 이상 할당할 수 있다.
    
- ChannelFuture 인터페이스: 네티의 모든 작업은 비동기다.즉 작업이 즉시완료되지 않은 상태에 대해 ChannelFuture를 통해 처리할 수 있다.
- ChannelHandler 인터페이스: 개발자 관점에서 네티의 핵심 컴포넌트는 데이터 처리가 적용되는 ChannelHandler이다. 네트워크 이벤트(입 출력, 연결 등) 채널 핸들러의 메서드가 트리거 된다.
- ChannelPipeline 인터페이스: ChannelHandler 체인을 위한 컨테이너를 제공하며, 체인 상에서 인바운드 혹은 아웃바운드 이벤트를 전파한다. 채널이 생성되면 자동으로 파이프라인이 할당된다.
- Encoder, Decoder: 네티는 메시지를 전송하거나 수신할 때 데이터를 변환해야 한다. 인바운드 메시지는 바이트에서 다른 포맷으로 변환되는 디코딩을 거칠 수 있고, 아웃바운드 메시지는 다른 포맷에서 바이트로 변환 될 수 있다.(인코더와 디코더는 네티의 가장 강력한 컴포넌트 중 하나이다.)
- BootStrap: 부트스트랩 클래스는 프로세스를 지정된 포트로 바인딩하거나 다른 호스트로 연결하는 등 네트워크 레이어를 구성하는 컨테이너를 제공한다.   

## 4장. 전송

## 5장. ByteBuf

## 6장. ChannelHandler 와 ChannelPipeline

## 7장. EventLoop 와 스레딩 모델

## 8장. 부트스트랩

## 9장. 단위테스트

## 10장 ~ 11장. 코덱

## 12장. 웹소켓

## 13장. UDP를 이용한 이벤트 브로드 캐스팅
